(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 9.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[     12353,        317]
NotebookOptionsPosition[     11777,        292]
NotebookOutlinePosition[     12185,        310]
CellTagsIndexPosition[     12142,        307]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"SquareDuino", " ", "-", " ", 
    RowBox[{"Note", " ", "Count", " ", "Computation"}]}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"(", "c", ")"}], " ", "2014"}], ",", " ", 
    RowBox[{"Alfred", " ", "\"\<Ben\>\"", " ", "Roney"}], ",", " ", 
    RowBox[{"Ph", ".", "D", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"All", " ", "rights", " ", 
    RowBox[{"reserved", "."}]}], " ", "*)"}]}]], "Input",
 CellChangeTimes->{{3.621797965746647*^9, 3.621798122443851*^9}, {
  3.622137049602489*^9, 3.6221370897655087`*^9}, {3.622139838570959*^9, 
  3.622139838882044*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "This", " ", "is", " ", "a", " ", "table", " ", "of", " ", "frequencies", 
    " ", "corresponding", " ", "to", " ", "MIDI", " ", "note", " ", 
    RowBox[{"values", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "They", " ", "are", " ", "scaled", " ", "by", " ", "three", " ", "to", 
     " ", "facilitate", " ", "generating", " ", "root"}], "-", "fifth", "-", 
    "sub"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
     RowBox[{
     "by", " ", "dividing", " ", "the", " ", "core", " ", "oscillator", " ", 
      "with", " ", "3"}], "-", "2", "-", "6"}], ",", " ", 
    RowBox[{"respectively", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"ConcertA", " ", ":=", " ", "440"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Define", " ", "this", " ", "according", " ", "to", " ", "your", " ", 
     "desired", " ", "pitch", " ", "reference"}], " ", "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"Don", "'"}], "t", " ", "edit", " ", "the", " ", "following"}], 
    " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"A440", " ", ":=", " ", "440"}], "\[IndentingNewLine]", 
   RowBox[{"FreqScale", " ", ":=", " ", 
    FractionBox[
     RowBox[{"Rationalize", "[", 
      RowBox[{"ConcertA", ",", 
       RowBox[{"ConcertA", " ", 
        SuperscriptBox["2", 
         RowBox[{"-", "1024"}]]}]}], "]"}], "A440"]}], "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{"ftab", "=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"FullSimplify", "[", 
        RowBox[{"3", 
         FractionBox[
          RowBox[{"FreqScale", " ", "A440"}], "32"], 
         SuperscriptBox["2", 
          FractionBox[
           RowBox[{"i", "-", "9"}], "12"]]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "0", ",", "127"}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"N", "[", "ftab", "]"}], "//", "InputForm", 
    "\[IndentingNewLine]"}]}]}]], "Input",
 CellChangeTimes->{{3.5978607371435547`*^9, 3.5978607476716413`*^9}, {
  3.59786092970679*^9, 3.597860985214576*^9}, {3.597861031046933*^9, 
  3.5978610351089582`*^9}, {3.622137114689094*^9, 3.622137168696066*^9}, {
  3.622137464440712*^9, 3.6221374678051167`*^9}, {3.622137548579081*^9, 
  3.622137555586069*^9}, {3.6221376899849453`*^9, 3.622137840408297*^9}, {
  3.6221379014025917`*^9, 3.622137905039886*^9}, {3.622137987433189*^9, 
  3.622138121412587*^9}, {3.622139896643015*^9, 3.6221398987014227`*^9}, {
  3.623785075201172*^9, 3.6237850929443083`*^9}, {3.62378556396427*^9, 
  3.623785570183189*^9}, {3.623785620420938*^9, 3.623785622525112*^9}, {
  3.623785658115457*^9, 3.623785737488945*^9}, {3.6238406314501143`*^9, 
  3.623840631907552*^9}}],

Cell["\<\
{24.52739674693112, 25.98587165408176, 27.53107199225696, 29.168154723945083, \
30.902583460581557, 
 32.740146696844114, 34.68697712921573, 36.74957212328899, 38.93481539811986, \
41.25, 43.702852642320934, 
 46.30155949276164, 49.05479349386224, 51.97174330816352, 55.06214398451392, \
58.336309447890166, 
 61.805166921163114, 65.48029339368823, 69.37395425843145, 73.49914424657798, \
77.86963079623972, 82.5, 
 87.40570528464187, 92.60311898552328, 98.10958698772448, 103.94348661632704, \
110.12428796902783, 
 116.67261889578033, 123.61033384232623, 130.96058678737646, \
138.7479085168629, 146.99828849315597, 
 155.73926159247944, 165., 174.81141056928374, 185.20623797104656, \
196.21917397544897, 
 207.88697323265407, 220.24857593805567, 233.3452377915607, \
247.22066768465245, 261.9211735747529, 
 277.4958170337258, 293.99657698631194, 311.4785231849588, 330., \
349.6228211385675, 370.4124759420931, 
 392.43834795089793, 415.77394646530814, 440.49715187611133, \
466.6904755831214, 494.4413353693049, 
 523.8423471495058, 554.9916340674516, 587.9931539726239, 622.9570463699176, \
660., 699.245642277135, 
 740.8249518841862, 784.8766959017959, 831.5478929306163, 880.9943037522227, \
933.3809511662428, 
 988.8826707386098, 1047.6846942990117, 1109.9832681349033, \
1175.9863079452477, 1245.9140927398353, 
 1320., 1398.49128455427, 1481.6499037683725, 1569.7533918035917, \
1663.0957858612326, 
 1761.9886075044453, 1866.7619023324855, 1977.7653414772196, \
2095.3693885980233, 2219.9665362698065, 
 2351.9726158904955, 2491.8281854796705, 2640., 2796.98256910854, \
2963.299807536745, 3139.5067836071835, 
 3326.191571722465, 3523.9772150088907, 3733.523804664971, \
3955.5306829544393, 4190.738777196047, 
 4439.933072539613, 4703.945231780991, 4983.656370959341, 5280., \
5593.96513821708, 5926.59961507349, 
 6279.013567214367, 6652.38314344493, 7047.954430017781, 7467.047609329942, \
7911.0613659088785, 
 8381.477554392093, 8879.866145079226, 9407.890463561982, 9967.312741918682, \
10560., 11187.93027643416, 
 11853.19923014698, 12558.027134428734, 13304.76628688986, \
14095.908860035563, 14934.095218659884, 
 15822.122731817757, 16762.955108784186, 17759.732290158452, \
18815.780927123964, 19934.625483837364, 
 21120., 22375.86055286832, 23706.39846029396, 25116.054268857468, \
26609.53257377972, 
 28191.817720071125, 29868.19043731977, 31644.245463635514, \
33525.91021756837, 35519.464580316904, 
 37631.56185424793}\
\>", "Output",
 CellChangeTimes->{3.623785065469185*^9, 3.6237852431534443`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "This", " ", "generates", " ", "a", " ", "table", " ", "of", " ", "timer", 
    " ", "count", " ", "comparison", " ", "values", " ", "that"}], " ", 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "corresponds", " ", "to", " ", "the", " ", "MIDI", " ", "note", " ", 
    "frequencies", " ", 
    RowBox[{"above", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
     RowBox[{
     "It", " ", "is", " ", "accurate", " ", "to", " ", "less", " ", "than"}], 
     " ", "\[PlusMinus]", 
     RowBox[{"1", " ", "cent", " ", "from", " ", "C0"}]}], "-", 
    RowBox[{"C5", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"For", " ", "higher", " ", "registers"}], ",", " ", 
    RowBox[{"adjust", " ", "the", " ", 
     RowBox[{"prescaler", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"Make", " ", "sure", " ", "that", " ", "note", " ", "0", " ", 
    RowBox[{"doesn", "'"}], "t", " ", "exceed", " ", "the", " ", "max", " ", 
    "count", " ", "of", " ", "your", " ", 
    RowBox[{"timer", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"preScaler", " ", ":=", " ", 
    SuperscriptBox["2", "5"]}], "\[IndentingNewLine]", 
   RowBox[{"clockFreq", " ", ":=", 
    RowBox[{"16", " ", 
     SuperscriptBox["10", "6"]}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"timerRes", "[", 
     RowBox[{"prescale_", ",", "clockFreq_"}], "]"}], ":=", 
    RowBox[{"(", 
     RowBox[{"prescale", 
      SuperscriptBox[
       RowBox[{"(", "clockFreq", ")"}], 
       RowBox[{"-", "1"}]]}], ")"}]}], "\[IndentingNewLine]", 
   RowBox[{"timerCounts", "/.", 
    RowBox[{
     RowBox[{"Solve", "[", 
      RowBox[{
       RowBox[{"targetTime", "\[Equal]", 
        RowBox[{"timerResolution", 
         RowBox[{"(", 
          RowBox[{"timerCounts", "+", "1"}], ")"}]}]}], ",", "timerCounts"}], 
      "]"}], "[", 
     RowBox[{"[", "1", "]"}], "]"}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"periodToCount", "[", 
      RowBox[{"targetTime_", ",", "prescale_", ",", "clockFreq_"}], "]"}], 
     "=", 
     RowBox[{"FullSimplify", "[", 
      RowBox[{"%", "/.", 
       RowBox[{"timerResolution", "\[Rule]", 
        RowBox[{"timerRes", "[", 
         RowBox[{"prescale", ",", "clockFreq"}], "]"}]}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Round", "[", 
     RowBox[{
      RowBox[{"FullSimplify", "[", 
       RowBox[{
        RowBox[{
         FractionBox[
          RowBox[{
           RowBox[{
            FractionBox["1", "2"], 
            FractionBox["1", 
             RowBox[{"Rationalize", "[", 
              RowBox[{"#", ",", 
               RowBox[{"#", " ", 
                SuperscriptBox["2", 
                 RowBox[{"-", "1024"}]]}]}], "]"}]]}], "-", 
           RowBox[{"timerRes", "[", 
            RowBox[{"preScaler", ",", "clockFreq"}], "]"}]}], 
          RowBox[{"timerRes", "[", 
           RowBox[{"preScaler", ",", "clockFreq"}], "]"}]], "&"}], "/@", 
        "ftab"}], "]"}], "//", "N"}], "]"}], "//", "InputForm"}]}]}]], "Input",\

 CellChangeTimes->{{3.5978608369486847`*^9, 3.597860914818866*^9}, {
  3.5978613400589237`*^9, 3.59786160346581*^9}, {3.5978617138924923`*^9, 
  3.597861824240006*^9}, {3.5978619589295893`*^9, 3.597862015281831*^9}, {
  3.622137192300931*^9, 3.62213721120065*^9}, {3.622137302799313*^9, 
  3.622137338515373*^9}, {3.622137471284307*^9, 3.6221375244463577`*^9}, {
  3.622138132885126*^9, 3.622138173551221*^9}, {3.622138203916745*^9, 
  3.6221382127719107`*^9}, {3.622139864211903*^9, 3.6221398684531803`*^9}, {
  3.622139960363195*^9, 3.622139997912003*^9}, {3.622140297134369*^9, 
  3.622140320796392*^9}, {3.622140354691971*^9, 3.622140405806551*^9}, {
  3.6237852576224003`*^9, 3.6237852912764273`*^9}}],

Cell[BoxData[
 FractionBox[
  RowBox[{"targetTime", "-", "timerResolution"}], 
  "timerResolution"]], "Output",
 CellChangeTimes->{
  3.623785065565404*^9, {3.623785243233233*^9, 3.623785292384665*^9}}],

Cell["\<\
{10192, 9620, 9080, 8570, 8089, 7635, 7206, 6802, 6420, 6060, 5719, 5398, \
5095, 4809, 4539, 4284, 4044, 
 3817, 3603, 3400, 3209, 3029, 2859, 2699, 2547, 2404, 2269, 2142, 2021, \
1908, 1801, 1700, 1604, 1514, 
 1429, 1349, 1273, 1202, 1134, 1070, 1010, 953, 900, 849, 802, 757, 714, 674, \
636, 600, 567, 535, 505, 
 476, 449, 424, 400, 378, 357, 336, 318, 300, 283, 267, 252, 238, 224, 212, \
200, 188, 178, 168, 158, 
 149, 141, 133, 125, 118, 112, 105, 99, 94, 88, 83, 79, 74, 70, 66, 62, 59, \
55, 52, 49, 46, 44, 41, 39, 
 37, 34, 32, 31, 29, 27, 26, 24, 23, 21, 20, 19, 18, 17, 16, 15, 14, 13, 12, \
12, 11, 10, 10, 9, 8, 8, 7, 
 7, 6, 6, 6}\
\>", "Output",
 CellChangeTimes->{
  3.623785065565404*^9, {3.623785243233233*^9, 3.62378529251659*^9}}]
}, Open  ]]
},
WindowSize->{930, 705},
WindowMargins->{{1, Automatic}, {Automatic, 0}},
PrintingCopies->1,
PrintingPageRange->{1, Automatic},
FrontEndVersion->"9.0 for Mac OS X x86 (32-bit, 64-bit Kernel) (January 25, \
2013)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[557, 20, 716, 17, 63, "Input"],
Cell[CellGroupData[{
Cell[1298, 41, 2892, 67, 249, "Input"],
Cell[4193, 110, 2545, 51, 400, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[6775, 166, 4012, 98, 335, "Input"],
Cell[10790, 266, 202, 5, 48, "Output"],
Cell[10995, 273, 766, 16, 130, "Output"]
}, Open  ]]
}
]
*)

(* End of internal cache information *)
